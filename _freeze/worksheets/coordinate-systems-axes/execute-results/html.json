{
  "hash": "e097297172102acb8853e8a1db496bcb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Coordinate systems and axes\"\nauthor: \"Claus O. Wilke\"\nformat: live-html\nengine: knitr\nwebr:\n  render-df: gt-interactive\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n## Introduction\n\nIn this worksheet, we will discuss how to change and customize scales and coordinate systems.\n\nFirst we need to load the required R packages. Please wait a moment until the live R session is fully set up and all packages are loaded.\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| warning: false\n#| edit: false\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n```\n:::\n\n\n\n\nNext we set up the data.\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\n#| warning: false\nboxoffice <- tibble(\n  rank = 1:5,\n  title = c(\"Star Wars\", \"Jumanji\", \"Pitch Perfect 3\", \"Greatest Showman\", \"Ferdinand\"),\n  amount = c(71.57, 36.17, 19.93, 8.81, 7.32) # million USD\n)\n\ntemperatures <- read_csv(\"https://wilkelab.org/SDS366/datasets/tempnormals.csv\") |>\n  mutate(\n    location = factor(\n      location, levels = c(\"Death Valley\", \"Houston\", \"San Diego\", \"Chicago\")\n    )\n  ) |>\n  select(location, day_of_year, month, temperature)\n\ntemps_wide <- temperatures |>\n  pivot_wider(names_from = location, values_from = temperature)\n\nUS_census <- read_csv(\"https://wilkelab.org/SDS366/datasets/US_census.csv\")\ntx_counties <- US_census |> \n  filter(state == \"Texas\") |>\n  select(name, pop2010) |>\n  extract(name, \"county\", regex = \"(.+) County\") |>\n  mutate(popratio = pop2010/median(pop2010)) |>\n  arrange(desc(popratio)) |>\n  mutate(index = 1:n())\n```\n:::\n\n\n\n\nWe will be working with three different datasets, `boxoffice`, `temperatures`, and `tx_counties`. You have already seen the first two previously.\n\nThe `boxoffice` dataset contains box-office gross results for Dec. 22-24, 2017.\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\nboxoffice\n```\n:::\n\n\n\n\nThe `temperatures` dataset contains the average temperature for each day of the year for four different locations.\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\ntemperatures\n```\n:::\n\n\n\n\nThe `tx_counties` dataset holds information about how many people lived in Texas counties in 2010. The column `popratio` is the ratio of the number of inhabitants to the median across all counties, and the column `index` simply counts the counties from most populous to least populous.\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\ntx_counties\n```\n:::\n\n\n\n\n## Scale customizations\n\nWe can modify the appearance of the x and y axis with scale functions. All scale functions have name of the form `scale_`*`aesthetic`*`_`*`type`*`()`, where *`aesthetic`* stands for an aesthetic to which we're mapping data (e.g., `x`, `y`, `color`, `fill`, etc), and *`type`* stands for the specific type of the scale. What scale types are available depends on both the aesthetic and the data.\n\nHere, we only consider position scales, which are scales for the `x` and `y` aesthetics. The most commonly used scales types for position scales are `continuous` for continuous data and `discrete` for discrete data, yielding the scale functions `scale_x_continuous()`, `scale_y_continuous()`, `scale_x_discrete()`, and `scale_y_discrete()`. But there are others, such as `date`, `time`, or `binned`. You can look them up here: [https://ggplot2.tidyverse.org/reference/index.html#section-scales](https://ggplot2.tidyverse.org/reference/index.html#section-scales)\n\nPosition scale functions are used to modify both the appearance of the axis (axis title, axis labels, number and location of breaks, etc.) and the mapping from data to position (including the range of data values considered, i.e., axis limits, and whether the data should be transformed, as is the case in log scales).\n\nLet's start with this plot of the `boxoffice` data:\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col()\n```\n:::\n\n\n\n\nWe can use scale functions to modify the axis titles, by setting the `name` argument. For example, `scale_x_continuous(name = \"the x value\")` would set the axis title to \"the x value\" in a continuous scale along the x axis.\n\nUse the appropriate scale functions to modify both axis titles in the above plot. Think about which axes (if any) are continuous and which are discrete.\n\n\n\n\n::: {.cell exercise='boxoffice-axis-title'}\n```{webr}\n#| exercise: boxoffice-axis-title\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  scale_x____() +\n  scale_y____()\n```\n:::\n\n\n\n\n::: { .hint exercise=\"boxoffice-axis-title\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  scale_x_continuous(___) +\n  scale_y_discrete(___)\n```\n:::\n:::\n\n::: { .solution exercise=\"boxoffice-axis-title\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  scale_x_continuous(name = \"weekend gross (million USD)\") +\n  scale_y_discrete(name = NULL)\n```\n:::\n:::\n\nWe can also use scale functions to set axis limits, via the `limits` argument. For continuous scales, the `limits` argument takes a vector of two numbers representing the lower and upper limit. For example, `limits = c(0, 80)` would indicate an axis that runs from 0 to 80. For discrete scales, the limits argument takes a vector of all the categories that should be shown, in the order in which they should be shown.\n\nTry this out by setting a limit from 0 to 80 on the x axis.\n\n\n\n\n::: {.cell exercise='boxoffice-xlims'}\n```{webr}\n#| exercise: boxoffice-xlims\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"boxoffice-xlims\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  scale_x_continuous(\n    name = \"weekend gross (million USD)\",\n    limits = ___\n  ) +\n  scale_y_discrete(name = NULL)\n```\n:::\n:::\n\n::: { .solution exercise=\"boxoffice-xlims\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  scale_x_continuous(\n    name = \"weekend gross (million USD)\",\n    limits = c(0, 80)\n  ) +\n  scale_y_discrete(name = NULL)\n```\n:::\n:::\n\nWhat happens if you set the axis limits such that not all data points can be shown, for example an upper limit of 65 rather than 80? Do you understand why?\n\n(Hint: Scale limits are applied before the plot is drawn, and data points outside the scale limits are discarded. If this is not what you want, there's an alternative way of setting limits. See the very end of this worksheet under \"Coords\".)\n\nNext, we can use the `breaks` and `labels` arguments to customize which axis ticks are shown and how they are labeled. In general, you need exactly as many breaks as labels. If you define only breaks but not labels then labels are automatically generated from the breaks.\n\nBuilding on the code from the previous example, set breaks at 0, 25, 50, and 75, and format the labels such that they can be read as currency. For example, write $25M instead of just 25.\n\n\n\n\n::: {.cell exercise='boxoffice-breaks'}\n```{webr}\n#| exercise: boxoffice-breaks\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"boxoffice-breaks\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  scale_x_continuous(\n    name = \"weekend gross\",\n    limits = c(0, 80),\n    breaks = ___,\n    labels = ___\n  ) +\n  scale_y_discrete(name = NULL)\n```\n:::\n:::\n\n::: { .solution exercise=\"boxoffice-breaks\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  scale_x_continuous(\n    name = \"weekend gross\",\n    limits = c(0, 80),\n    breaks = c(0, 25, 50, 75),\n    labels = c(\"0\", \"$25M\", \"$50M\", \"$75M\")\n  ) +\n  scale_y_discrete(name = NULL)\n```\n:::\n:::\n\nWhen looking at the resulting plot, you may notice that the x axis extends beyond the limits you have set. This happens because by default ggplot scales expand the axis range by a small amount. You can set the axis expansion via the `expand` parameter. Setting the expansion can be a bit tricky, because we can set expansion at either end of a scale and we can define both additive and multiplicative expansion. (Additive expansion adds a fixed value, whereas multiplicative expansion adds a multiple of the scale range. ggplot uses additive expansion for discrete scales and multiplicative expansion for continuous scales, but you can use either for either scale.)\n\nThe simplest way to define expansions is with the `expansion()` function, which takes arguments `mult` for multiplicative expansion and `add` for additive expansion. Either takes a vector of two values, indicating expansion at the lower and upper end, respectively. Thus, `expansion(mult = c(0, 0.1))` indicates multiplicative expansion of 0% at the lower end and 10% at the upper end, whereas `expansion(add = c(2, 2))` indicates additive expansion of 2 units at either end of the scale.\n\nTry this yourself. Use the `expand` argument to remove the gap to the left of 0 on the x axis.\n\n\n\n\n::: {.cell exercise='boxoffice-expansion'}\n```{webr}\n#| exercise: boxoffice-expansion\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"boxoffice-expansion\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  scale_x_continuous(\n    name = \"weekend gross\",\n    limits = c(0, 80),\n    breaks = c(0, 25, 50, 75),\n    labels = c(\"0\", \"$25M\", \"$50M\", \"$75M\"),\n    expand = expansion(___)\n  ) +\n  scale_y_discrete(name = NULL)\n```\n:::\n:::\n\n::: { .solution exercise=\"boxoffice-expansion\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  scale_x_continuous(\n    name = \"weekend gross\",\n    limits = c(0, 80),\n    breaks = c(0, 25, 50, 75),\n    labels = c(\"0\", \"$25M\", \"$50M\", \"$75M\"),\n    expand = expansion(mult = c(0, 0.06))\n  ) +\n  scale_y_discrete(name = NULL)\n```\n:::\n:::\n\nTry different settings for the `expand` argument. Try both multiplicative and additive expansions. Apply different expansions to the y axis as well.\n\n\n## Logarithmic scales\n\nScales can also transform the data before plotting. For example, log scales such as `scale_x_log10()` and `scale_y_log10()` log-transform the data. To try this out, we'll be working with the `tx_counties` dataset:\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\nggplot(tx_counties) +\n  aes(x = index, y = popratio) +\n  geom_point()\n```\n:::\n\n\n\n\nModify this plot so the y axis uses a log scale.\n\n\n\n\n::: {.cell exercise='tx-counties-log'}\n```{webr}\n#| exercise: tx-counties-log\nggplot(tx_counties) +\n  aes(x = index, y = popratio) +\n  geom_point() +\n  ___\n```\n:::\n\n\n\n\n::: { .solution exercise=\"tx-counties-log\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(tx_counties) +\n  aes(x = index, y = popratio) +\n  geom_point() +\n  scale_y_log10()\n```\n:::\n:::\n\nNow customize the log scale by setting `name`, `limits`, `breaks`, and `labels`. These work exactly as they did in `scale_x_continuous()`.\n\n\n\n\n::: {.cell exercise='tx-counties-log-customize'}\n```{webr}\n#| exercise: tx-counties-log-customize\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"tx-counties-log-customize\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(tx_counties) +\n  aes(x = index, y = popratio) +\n  geom_point() +\n  scale_y_log10(\n    name = ___,\n    limits = ___,\n    breaks = ___,\n    labels = ___\n  )\n```\n:::\n:::\n\n::: { .solution exercise=\"tx-counties-log-customize\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(tx_counties) +\n  aes(x = index, y = popratio) +\n  geom_point() +\n  scale_y_log10(\n    name = \"population number / median\",\n    limits = c(0.003, 300),\n    breaks = c(0.01, 1, 100),\n    labels = c(\"0.01\", \"1\", \"100\")\n  )\n```\n:::\n:::\n\n## Coords\n\nWhile scales determine how data values are mapped and represented along one dimension, e.g. the x or the y axis, coordinate systems define how these dimensions are projected onto the 2d plot surface. The default coordinate system is the Cartesian coordinate system, which uses orthogonal x and y axes. In the following example, I have added the coord explicitly, but this is not normally necessary.\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\nggplot(temperatures, aes(day_of_year, temperature, color = location)) +\n  geom_line() +\n  coord_cartesian()  # this is always added by default\n```\n:::\n\n\n\n\nWe can however add a different coord, for example `coord_polar()` to use a polar coordinate system. Try this out.\n\n\n\n\n::: {.cell exercise='temperatures-polar'}\n```{webr}\n#| exercise: temperatures-polar\n\n```\n:::\n\n\n\n\n::: { .solution exercise=\"temperatures-polar\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temperatures, aes(day_of_year, temperature, color = location)) +\n  geom_line() +\n  coord_polar()\n```\n:::\n:::\n\nIn the polar coordinate system, the y axis (here, temperature) is mapped onto the radius, and the x axis (here, day of year) is mapped onto the angle. You can use `scale_x_continuous()` and `scale_y_continuous()` to modify the radial and angular axes. For example, you may want to change the temperature limits from 0 to 105 so the temperature curve for Chicago doesn't hit the exact center of the plot. Try this out.\n\n\n\n\n::: {.cell exercise='temperatures-polar2'}\n```{webr}\n#| exercise: temperatures-polar2\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"temperatures-polar2\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(temperatures, aes(day_of_year, temperature, color = location)) +\n  geom_line() +\n  coord_polar() +\n  scale_y_continuous(limits = ___)\n```\n:::\n:::\n\n::: { .solution exercise=\"temperatures-polar2\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temperatures, aes(day_of_year, temperature, color = location)) +\n  geom_line() +\n  coord_polar() +\n  scale_y_continuous(limits = c(0, 105))\n```\n:::\n:::\n\nThere are other useful coords. For example, `coord_fixed()` is a Cartesian coordinate system with fixed aspect ratio. This is useful when we plot variables along the x and y axes that are measured in the same units. In this case, we want the two axes to be coordinated, such that one step along x has the same meaning as one step along y.\n\nTo demonstrate this, we reshape the `temperatures` dataset into wide format, and then plot temperatures in San Diego versus temperatures in Houston.\n\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\ntemps_wide <- temperatures |>\n  pivot_wider(names_from = location, values_from = temperature)\n\ntemps_wide\n```\n:::\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\nggplot(temps_wide, aes(`San Diego`, Houston)) +\n  geom_point()\n```\n:::\n\n\n\n\n(A side remark: Do you know why we write `` `San Diego` `` and not `\"San Diego\"` or `'San Diego'` inside the `aes()` function? If you don't, see if you can find out.)\n\nThe units along both the x and the y axis are temperatures, but a 10 degree difference in Houston is shown as a shorter distance than a 10 degree difference in San Diego. To address this problem, add `coord_fixed()` to the above plot.\n\n\n\n\n::: {.cell exercise='temps-scatter-coord'}\n```{webr}\n#| exercise: temps-scatter-coord\n\n```\n:::\n\n\n\n\n::: { .solution exercise=\"temps-scatter-coord\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temps_wide, aes(`San Diego`, Houston)) +\n  geom_point() +\n  coord_fixed()\n```\n:::\n:::\n\nThis plot is technically correct but it doesn't look good, because breaks are spaced differently along the two axes. Also, the plot looks strangely narrow and tall. We can fix both issues by manually setting breaks and limits for both axes. Try this out.\n\n\n\n\n::: {.cell exercise='temps-scatter-coord2'}\n```{webr}\n#| exercise: temps-scatter-coord2\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"temps-scatter-coord2\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(temps_wide, aes(`San Diego`, Houston)) +\n  geom_point() +\n  coord_fixed() +\n  scale_x_continuous(\n    limits = ___,\n    breaks = ___\n  ) +\n  scale_y_continuous(\n    limits = ___,\n    breaks = ___\n  )\n```\n:::\n:::\n\n::: { .solution exercise=\"temps-scatter-coord2\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temps_wide, aes(`San Diego`, Houston)) +\n  geom_point() +\n  coord_fixed() +\n  scale_x_continuous(\n    limits = c(45, 85),\n    breaks = c(40, 50, 60, 70, 80)\n  ) +\n  scale_y_continuous(\n    limits = c(48, 88),\n    breaks = c(50, 60, 70, 80)\n  )\n```\n:::\n:::\n\nFinally, as the last example of what can be done with coords, we go back to the problem of setting limits on the box-office bar plot. Instead of setting limits with scale functions, we can also set them via the arguments `xlim` and `ylim` inside the coord, for example here `coord_cartesian()`. (This would be a good reason to explicity add `coord_cartesian()` to a plot.) When we set limits in the coord ggplot does not discard any data points. Instead it simply zooms in or out according to the limits set. Try this out by setting the x limits from 10 to 65 in the box-office plot.\n\n\n\n\n::: {.cell exercise='boxoffice-coord-xlims'}\n```{webr}\n#| exercise: boxoffice-coord-xlims\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  ___\n```\n:::\n\n\n\n\n::: { .hint exercise=\"boxoffice-coord-xlims\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  coord_cartesian(\n    xlim = ___\n  )\n```\n:::\n:::\n\n::: { .solution exercise=\"boxoffice-coord-xlims\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(boxoffice) +\n  aes(amount, fct_reorder(title, amount)) +\n  geom_col() +\n  coord_cartesian(\n    xlim = c(10, 65)\n  )\n```\n:::\n:::\n\n**Note:** It is normally not a good idea to start a bar plot at a value other than 0. This exercise was solely meant to demonstrate how limits in coords differ from limits in scales.\n\n\n",
    "supporting": [
      "coordinate-systems-axes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}