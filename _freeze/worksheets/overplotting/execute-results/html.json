{
  "hash": "0ce16fa26ec7b33e0e6a139940a4d4cb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Dealing with overplotting\"\nauthor: \"Claus O. Wilke\"\nformat: live-html\nengine: knitr\nwebr:\n  render-df: gt-interactive\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n## Introduction\n\nIn this worksheet, we will discuss how to make 2D density plots and histograms, to effectively visualize scatter plots in which many points lie on top of one another.\n\nFirst we need to load the required R packages. Please wait a moment until the live R session is fully set up and all packages are loaded.\n\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| warning: false\n#| edit: false\nlibrary(tidyverse)\nlibrary(palmerpenguins)\nlibrary(hexbin)\n```\n:::\n\n\n\n\n\nNext we set up the data. We will be working with data on individual penguins in Antarctica.\n```r\npenguins\n```\n\n::: {.column-page}\n\n\n\n\n::: {.cell}\n```{webr}\n#| echo: false\npenguins\n```\n:::\n\n\n\n\n:::\n\n## 2D density plots\n\n2D density plots are a replacement for and alternative to scatter plots. They visualize the density of points in the 2D plane, and they are particularly useful when the point density is very high, so that many points lie on top of one another. We will demonstrate 2D density plots for the `penguins` dataset, specifically for a scatter plot of bill length versus body mass.\n\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_point(na.rm = TRUE) +\n  theme_bw()\n```\n:::\n\n\n\n\n\nTo create a 2D density plot, we simply add `geom_density_2d()`. Try this out.\n\n\n\n\n\n::: {.cell exercise='density-lines'}\n```{webr}\n#| exercise: density-lines\n\n```\n:::\n\n\n\n\n\n::: { .hint exercise=\"density-lines\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  ___ +\n  geom_point(na.rm = TRUE) +\n  theme_bw()\n```\n:::\n:::\n\n::: { .solution exercise=\"density-lines\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_density_2d(na.rm = TRUE) + \n  geom_point(na.rm = TRUE) +\n  theme_bw()\n```\n:::\n:::\n\nYou can change the number of contour lines shown by providing the `bins` argument to `geom_density_2d()`. For example, try `bins = 5`.\n\n\n\n\n\n::: {.cell exercise='density-lines2'}\n```{webr}\n#| exercise: density-lines2\n\n```\n:::\n\n\n\n\n\n::: { .hint exercise=\"density-lines2\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_density_2d(na.rm = TRUE, bins = ___) + \n  geom_point(na.rm = TRUE) +\n  theme_bw()\n```\n:::\n:::\n\n::: { .solution exercise=\"density-lines2\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_density_2d(na.rm = TRUE, bins = 5) + \n  geom_point(na.rm = TRUE) +\n  theme_bw()\n```\n:::\n:::\n\nAlso try other values for `bins`.\n\nThe plots we have made so far did not consider different penguin species, but we know from earlier worksheets that there are three penguins species with quite different values for body mass and bill length. Modify the above plot so that both points and contour lines are colored by species.\n\n\n\n\n\n::: {.cell exercise='density-lines-colors'}\n```{webr}\n#| exercise: density-lines-colors\n\n```\n:::\n\n\n\n\n\n::: { .solution exercise=\"density-lines-colors\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm, color = species)) +\n  geom_density_2d(na.rm = TRUE, bins = 5) + \n  geom_point(na.rm = TRUE) +\n  theme_bw()\n```\n:::\n:::\n\nAlso try faceting by species.\n\n\n\n\n\n::: {.cell exercise='density-lines-facets'}\n```{webr}\n#| exercise: density-lines-facets\n\n```\n:::\n\n\n\n\n\n::: { .solution exercise=\"density-lines-facets\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm, color = species)) +\n  geom_density_2d(na.rm = TRUE, bins = 5) + \n  geom_point(na.rm = TRUE) +\n  theme_bw() +\n  facet_wrap(~species)\n```\n:::\n:::\n\nFinally, you can use `geom_density_2d_filled()` to draw filled contour bands instead of contour lines. Try this out.\n\n**Hints:**\n\n- You cannot map penguin species to color when drawing contour bands.\n- It helps to set alpha transparency for contour bands, e.g. `alpha = 0.5`.\n- You may want to make the point size smaller so you can see the contour bands underneath the points.\n\n**Note:** This example may not work in the live web environment.\n\n\n\n\n\n::: {.cell exercise='density-bands'}\n```{webr}\n#| exercise: density-bands\n\n```\n:::\n\n\n\n\n\n::: { .hint exercise=\"density-bands\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_density_2d_filled(___) + \n  geom_point(na.rm = TRUE, size = ___) +\n  theme_bw() +\n  facet_wrap(~species)\n```\n:::\n:::\n\n::: { .solution exercise=\"density-bands\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_density_2d_filled(na.rm = TRUE, bins = 5, alpha = 0.5) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species)\n```\n:::\n:::\n\n## 2D histograms\n\n2D histograms are very similar to 2D density plots. They are generated by simply subdividing the 2D plane into regularly shaped regions (rectangles or hexagons), counting how many data points fall into each region, and then coloring each region by its count.\n\nTo make rectangular 2D hexagons, you can use `geom_bin2d()`. Try this out.\n\n**Hint:** Set `bins = 5` to get a reasonable number of bins for this dataset.\n\n\n\n\n\n::: {.cell exercise='bins2d-facets'}\n```{webr}\n#| exercise: bins2d-facets\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  ___ +\n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species)\n```\n:::\n\n\n\n\n\n::: { .hint exercise=\"bins2d-facets\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_bin2d(___) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species)\n```\n:::\n:::\n\n::: { .solution exercise=\"bins2d-facets\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_bin2d(na.rm = TRUE, bins = 5) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species)\n```\n:::\n:::\n\nIt helps to make the bins partially transparent (i.e., set `alpha = 0.5`). Also use a different sequential color scale.\n\n\n\n\n\n::: {.cell exercise='bins2d-facets2'}\n```{webr}\n#| exercise: bins2d-facets2\n\n```\n:::\n\n\n\n\n\n::: { .hint exercise=\"bins2d-facets2\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_bin2d(na.rm = TRUE, bins = 5, ___) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species) +\n  scale_fill____\n```\n:::\n:::\n\n::: { .solution exercise=\"bins2d-facets2\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_bin2d(na.rm = TRUE, bins = 5, alpha = 0.5) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species) +\n  scale_fill_viridis_c()\n```\n:::\n:::\n\nYou can control bins in a more fine-grained manner by setting the `binwidth` argument. It takes a vector of two numbers, where the first is the width of the bins (in data units) and the second is the height (also in data units). Make bins that are 10000 units wide and 5 units tall.\n\n\n\n\n\n::: {.cell exercise='bins2d-facets3'}\n```{webr}\n#| exercise: bins2d-facets3\n\n```\n:::\n\n\n\n\n\n::: { .hint exercise=\"bins2d-facets3\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_bin2d(\n    na.rm = TRUE,\n    binwidth = ___,\n    alpha = 0.5\n  ) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species) +\n  scale_fill_viridis_c()\n```\n:::\n:::\n\n::: { .solution exercise=\"bins2d-facets3\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_bin2d(\n    na.rm = TRUE,\n    binwidth = c(10000, 5),\n    alpha = 0.5\n  ) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species) +\n  scale_fill_viridis_c()\n```\n:::\n:::\n\nAlso try making bins that are 30 units tall and 2500 units wide.\n\nInstead of rectangular bins, you can also make hexbins, with `geom_hex()`. It mostly works the same as `geom_bin2d()`. Try it out.\n\n**Hint:** You will need to set the argument `bins` to an appropriate value for the hexbins to look good.\n\n\n\n\n\n::: {.cell exercise='hex-facets'}\n```{webr}\n#| exercise: hex-facets\n\n```\n:::\n\n\n\n\n\n::: { .hint exercise=\"hex-facets\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_hex(\n    ___\n  ) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species) +\n  scale_fill_viridis_c()\n```\n:::\n:::\n\n::: { .solution exercise=\"hex-facets\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_hex(\n    na.rm = TRUE,\n    bins = 5,\n    alpha = 0.5\n  ) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species) +\n  scale_fill_viridis_c()\n```\n:::\n:::\n\nJust as was the case with `geom_bin2d()`, you can provide an argument `binwidth` consisting of two values, one controling the width and the other the height. Try this out.\n\n\n\n\n\n::: {.cell exercise='hex-facets2'}\n```{webr}\n#| exercise: hex-facets2\n\n```\n:::\n\n\n\n\n\n::: { .hint exercise=\"hex-facets2\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_hex(\n    na.rm = TRUE,\n    binwidth = ___\n    alpha = 0.5\n  ) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species) +\n  scale_fill_viridis_c()\n```\n:::\n:::\n\n::: { .solution exercise=\"hex-facets2\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(penguins, aes(body_mass_g, bill_length_mm)) +\n  geom_hex(\n    na.rm = TRUE,\n    binwidth = c(1000, 5),\n    alpha = 0.5\n  ) + \n  geom_point(na.rm = TRUE, size = 0.2) +\n  theme_bw() +\n  facet_wrap(~species) +\n  scale_fill_viridis_c()\n```\n:::\n:::\n",
    "supporting": [
      "overplotting_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}